# x0 (xzero) HTTP web server: sample configuration file.
# vim:syntax=flow

extern int printf(string, ...);

// require 'x0/1.0.0';

# rules to be invoked at service startup
handler setup
{
	plugin.directory = sys.cwd + '/plugins/';

	plugin.load 'dirlisting', 'staticfile', 'fastcgi';
	plugin.load 'echo_example', 'hello_example';
	plugin.load 'accesslog', 'indexfile';

	listen '0.0.0.0:8080';

	mimetypes = '/etc/mime.types';
	mimetypes.default = 'text/plain';

	server.tags = ('foo', 'bar', ('com', 42, 'blah'));
	server.advertise = 1;
}

# every request's entry point is main
handler main
{
	#__print sys.now_str, req.host, req.remoteip, req.localport, req.path;
	accesslog = '/dev/stdout';

	docroot '/home/trapni/local/src/redmine/public/';

	#if req.path =^ '/hello' then hello_example;
	#else if req.path =^ '/echo' then echo_example;
	#else if req.path =^ '/welcome' then redirect '/hello';

	autoindex(('index.php', 'index.html'));

	# enable directory listings
	#if phys.is_dir and not req.path == '/' then dirlisting;

	# static files

	# pass to web app, otherwise
	#else fastcgi '127.0.0.1:2001';

	dirlisting;
	staticfile;
}
